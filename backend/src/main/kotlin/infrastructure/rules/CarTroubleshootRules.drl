package infrastructure.rules

import domain.models.*
import domain.enums.*
import java.util.ArrayList

dialect "java"

// Rule 1: Dead Battery Detection
rule "Dead Battery Rule"
    when
        $s: Symptom(startingIssue == true)
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R001", "Dead Battery Rule",
            "Starting issue detected", "Check battery voltage and connections"));
        insert(new CarProblem("P001", "Dead Battery", "Battery has insufficient charge",
            ProblemCategory.BATTERY, Severity.MEDIUM,
            ["Old battery", "Parasitic drain", "Faulty alternator"],
            ["Jump start car", "Replace battery", "Check charging system"],
            150.0, "1-2 hours"));
end

// Rule 2: Alternator Failure
rule "Alternator Failure Rule"
    when
        $s: Symptom(startingIssue == true, warningLights contains "Battery")
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R002", "Alternator Failure Rule",
            "Battery warning light + starting issue", "Test alternator output"));
        insert(new CarProblem("P002", "Faulty Alternator", "Alternator not charging battery",
            ProblemCategory.ELECTRICAL, Severity.HIGH,
            ["Worn brushes", "Faulty voltage regulator", "Bad diodes"],
            ["Replace alternator", "Check drive belt"], 400.0, "2-3 hours"));
end

// Rule 3: Starter Motor Failure
rule "Starter Motor Failure Rule"
    when
        $s: Symptom(startingIssue == true, engineType != EngineType.ELECTRIC)
        exists(CarProblem(id == "P001") or CarProblem(id == "P002"))
    then
        insert(new RuleExecution("R003", "Starter Motor Failure Rule",
            "Starting issue persists after battery/alternator check",
            "Test starter motor"));
end

// Rule 4: Overheating Engine
rule "Engine Overheating Rule"
    when
        $s: Symptom(overheating == true)
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R004", "Engine Overheating Rule",
            "Engine temperature above normal", "Check cooling system"));
        insert(new CarProblem("P004", "Cooling System Failure",
            "Engine overheating detected", ProblemCategory.COOLING_SYSTEM, Severity.CRITICAL,
            ["Low coolant", "Faulty thermostat", "Water pump failure", "Clogged radiator"],
            ["Check coolant level", "Replace thermostat", "Flush cooling system"],
            300.0, "3-4 hours"));
end

// Rule 5: Coolant Leak
rule "Coolant Leak Detection"
    when
        $s: Symptom(fluidLeaks contains "Green" || fluidLeaks contains "Orange")
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R005", "Coolant Leak Detection",
            "Colored fluid leak detected", "Inspect for coolant leaks"));
        insert(new CarProblem("P005", "Coolant Leak", "Coolant leakage detected",
            ProblemCategory.COOLING_SYSTEM, Severity.HIGH,
            ["Hose failure", "Radiator crack", "Water pump seal failure"],
            ["Pressure test system", "Replace leaking components"],
            200.0, "2-3 hours"));
end

// Rule 6: Oil Leak
rule "Oil Leak Detection"
    when
        $s: Symptom(fluidLeaks contains "Brown" || fluidLeaks contains "Black")
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R006", "Oil Leak Detection",
            "Dark fluid leak detected", "Check oil level and source"));
        insert(new CarProblem("P006", "Oil Leak", "Engine oil leakage",
            ProblemCategory.ENGINE, Severity.MEDIUM,
            ["Valve cover gasket", "Oil pan gasket", "Rear main seal"],
            ["Identify leak source", "Replace gaskets/seals"],
            250.0, "2-4 hours"));
end

// Rule 7: Transmission Fluid Leak
rule "Transmission Fluid Leak"
    when
        $s: Symptom(fluidLeaks contains "Red", transmissionIssues != null)
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R007", "Transmission Fluid Leak",
            "Red fluid leak + transmission issues", "Check transmission fluid"));
        insert(new CarProblem("P007", "Transmission Fluid Leak",
            "Transmission fluid leakage", ProblemCategory.TRANSMISSION, Severity.HIGH,
            ["Transmission seal failure", "Pan gasket leak"],
            ["Check fluid level", "Replace seals", "Top up fluid"],
            350.0, "3-5 hours"));
end

// Rule 8: Brake Fluid Leak
rule "Brake Fluid Leak"
    when
        $s: Symptom(fluidLeaks contains "Clear" || fluidLeaks contains "Yellow",
                   brakingIssues != null)
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R008", "Brake Fluid Leak",
            "Clear/Yellow fluid + braking issues", "Check brake system"));
        insert(new CarProblem("P008", "Brake Fluid Leak",
            "Brake hydraulic system leak", ProblemCategory.BRAKING_SYSTEM, Severity.CRITICAL,
            ["Brake line corrosion", "Caliper/wheel cylinder leak", "Master cylinder failure"],
            ["Inspect brake lines", "Bleed brake system", "Replace components"],
            400.0, "4-6 hours"));
end

// Rule 9: Check Engine Light
rule "Check Engine Light Rule"
    when
        $s: Symptom(warningLights contains "Check Engine")
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R009", "Check Engine Light Rule",
            "Check Engine light is on", "Read diagnostic trouble codes"));
        insert(new CarProblem("P009", "Engine Control Issue",
            "Check Engine light illuminated", ProblemCategory.ENGINE, Severity.MEDIUM,
            ["O2 sensor failure", "Catalytic converter", "Ignition coil", "Mass airflow sensor"],
            ["Read OBD-II codes", "Diagnose specific fault"],
            150.0, "1 hour"));
end

// Rule 10: Multiple Warning Lights
rule "Multiple Warning Lights Rule"
    when
        $s: Symptom(warningLights.size() >= 3)
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R010", "Multiple Warning Lights Rule",
            "Multiple warning lights active", "Check electrical system and ECU"));
        insert(new CarProblem("P010", "Electrical System Fault",
            "Multiple system warnings", ProblemCategory.ELECTRICAL, Severity.HIGH,
            ["Faulty ECU", "Grounding issues", "Voltage regulator"],
            ["Complete system scan", "Check wiring harness", "Test ECU"],
            500.0, "4-5 hours"));
end

// Rule 11: Rough Idling
rule "Rough Idle Rule"
    when
        $s: Symptom(roughIdling == true, engineType in (EngineType.GASOLINE, EngineType.DIESEL))
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R011", "Rough Idle Rule",
            "Engine runs rough at idle", "Check ignition and fuel systems"));
        insert(new CarProblem("P011", "Rough Idle Condition",
            "Unstable engine idle", ProblemCategory.IGNITION_SYSTEM, Severity.MEDIUM,
            ["Dirty fuel injectors", "Faulty spark plugs", "Vacuum leak", "Dirty throttle body"],
            ["Clean fuel system", "Replace spark plugs", "Check for vacuum leaks"],
            200.0, "2-3 hours"));
end

// Rule 12: Misfire Detection
rule "Engine Misfire Rule"
    when
        $s: Symptom(lossOfPower == true, roughIdling == true)
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R012", "Engine Misfire Rule",
            "Loss of power + rough idle", "Check for cylinder misfire"));
        insert(new CarProblem("P012", "Engine Misfire",
            "One or more cylinders not firing properly", ProblemCategory.IGNITION_SYSTEM, Severity.MEDIUM,
            ["Bad spark plugs", "Faulty ignition coils", "Fuel delivery issue"],
            ["Scan for misfire codes", "Test ignition components", "Check fuel pressure"],
            300.0, "2-3 hours"));
end

// Rule 13: Fuel Pump Failure
rule "Fuel Pump Failure Rule"
    when
        $s: Symptom(startingIssue == true, stalling == true, engineNoise == "Whining")
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R013", "Fuel Pump Failure Rule",
            "Whining noise + starting/stalling issues", "Test fuel pressure"));
        insert(new CarProblem("P013", "Fuel Pump Failure",
            "Insufficient fuel delivery", ProblemCategory.FUEL_SYSTEM, Severity.HIGH,
            ["Worn fuel pump", "Clogged fuel filter", "Electrical fault"],
            ["Replace fuel pump", "Change fuel filter", "Check wiring"],
            450.0, "3-4 hours"));
end

// Rule 14: Clogged Fuel Filter
rule "Clogged Fuel Filter Rule"
    when
        $s: Symptom(lossOfPower == true, fuelConsumptionIncreased == true, mileage > 30000)
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R014", "Clogged Fuel Filter Rule",
            "High mileage + power loss + increased fuel consumption", "Check fuel filter"));
        insert(new CarProblem("P014", "Clogged Fuel Filter",
            "Restricted fuel flow", ProblemCategory.FUEL_SYSTEM, Severity.LOW,
            ["Dirty fuel", "Normal wear"],
            ["Replace fuel filter"],
            100.0, "1 hour"));
end

// Rule 15: Dirty Air Filter
rule "Dirty Air Filter Rule"
    when
        $s: Symptom(lossOfPower == true, fuelConsumptionIncreased == true,
                   lastServiceMonths > 12)
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R015", "Dirty Air Filter Rule",
            "Long service interval + power/fuel issues", "Check air filter"));
        insert(new CarProblem("P015", "Dirty Air Filter",
            "Restricted air intake", ProblemCategory.ENGINE, Severity.LOW,
            ["Normal accumulation"],
            ["Replace air filter"],
            50.0, "0.5 hours"));
end

// Rule 16: Worn Spark Plugs
rule "Worn Spark Plugs Rule"
    when
        $s: Symptom(roughIdling == true, lossOfPower == true,
                   mileage > 50000, engineType == EngineType.GASOLINE)
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R016", "Worn Spark Plugs Rule",
            "High mileage gasoline engine + performance issues", "Inspect spark plugs"));
        insert(new CarProblem("P016", "Worn Spark Plugs",
            "Ignition performance degraded", ProblemCategory.IGNITION_SYSTEM, Severity.MEDIUM,
            ["Normal wear", "Incorrect gap"],
            ["Replace spark plugs", "Check ignition timing"],
            150.0, "1-2 hours"));
end

// Rule 17: Faulty Oxygen Sensor
rule "Oxygen Sensor Failure Rule"
    when
        $s: Symptom(fuelConsumptionIncreased == true,
                   warningLights contains "Check Engine")
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R017", "Oxygen Sensor Failure Rule",
            "Increased fuel consumption + Check Engine light", "Test O2 sensors"));
        insert(new CarProblem("P017", "Faulty Oxygen Sensor",
            "Incorrect air-fuel ratio measurement", ProblemCategory.EXHAUST_SYSTEM, Severity.MEDIUM,
            ["Normal degradation", "Contamination"],
            ["Replace oxygen sensor(s)"],
            250.0, "1-2 hours"));
end

// Rule 18: Catalytic Converter Issue
rule "Catalytic Converter Rule"
    when
        $s: Symptom(lossOfPower == true, unusualSmells contains "Rotten Egg",
                   smokeFromExhaust != null)
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R018", "Catalytic Converter Rule",
            "Rotten egg smell + power loss", "Check catalytic converter"));
        insert(new CarProblem("P018", "Catalytic Converter Failure",
            "Exhaust restriction", ProblemCategory.EXHAUST_SYSTEM, Severity.HIGH,
            ["Contamination", "Overheating", "Physical damage"],
            ["Replace catalytic converter"],
            1200.0, "3-4 hours"));
end

// Rule 19: Transmission Slipping
rule "Transmission Slipping Rule"
    when
        $s: Symptom(transmissionIssues == "Slipping", lossOfPower == true)
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R019", "Transmission Slipping Rule",
            "Transmission slips + power loss", "Check transmission fluid and condition"));
        insert(new CarProblem("P019", "Transmission Slipping",
            "Gear engagement issues", ProblemCategory.TRANSMISSION, Severity.HIGH,
            ["Low fluid", "Worn clutches", "Solenoid issues"],
            ["Check fluid level/condition", "Diagnose transmission"],
            800.0, "4-6 hours"));
end

// Rule 20: Brake Pad Wear
rule "Brake Pad Wear Rule"
    when
        $s: Symptom(brakingIssues == "Squealing", mileage > 25000)
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R020", "Brake Pad Wear Rule",
            "Squealing brakes + mileage", "Inspect brake pads"));
        insert(new CarProblem("P020", "Worn Brake Pads",
            "Brake pads at minimum thickness", ProblemCategory.BRAKING_SYSTEM, Severity.MEDIUM,
            ["Normal wear", "Aggressive driving"],
            ["Replace brake pads", "Resurface rotors if needed"],
            300.0, "2-3 hours"));
end

// Rule 21: Worn Brake Rotors
rule "Brake Rotor Wear Rule"
    when
        $s: Symptom(brakingIssues == "Vibration" || brakingIssues == "Pulsation")
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R021", "Brake Rotor Wear Rule",
            "Brake pedal vibration/pulsation", "Check brake rotors"));
        insert(new CarProblem("P021", "Worn/Damaged Brake Rotors",
            "Uneven rotor surface", ProblemCategory.BRAKING_SYSTEM, Severity.MEDIUM,
            ["Normal wear", "Overheating", "Improper installation"],
            ["Resurface or replace rotors"],
            400.0, "3-4 hours"));
end

// Rule 22: Suspension Issue
rule "Suspension Problem Rule"
    when
        $s: Symptom(unusualSmells contains "None", engineNoise == "Clunking")
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R022", "Suspension Problem Rule",
            "Clunking noise from suspension", "Inspect suspension components"));
        insert(new CarProblem("P022", "Suspension Component Failure",
            "Worn suspension parts", ProblemCategory.SUSPENSION, Severity.MEDIUM,
            ["Worn bushings", "Bad struts/shocks", "Ball joint wear"],
            ["Inspect and replace worn components"],
            600.0, "3-5 hours"));
end

// Rule 23: Tire Pressure Warning
rule "Tire Pressure Rule"
    when
        $s: Symptom(warningLights contains "Tire Pressure")
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R023", "Tire Pressure Rule",
            "Tire pressure warning light", "Check tire pressures"));
        insert(new CarProblem("P023", "Low Tire Pressure",
            "Tire(s) underinflated", ProblemCategory.SUSPENSION, Severity.LOW,
            ["Normal air loss", "Puncture", "Temperature changes"],
            ["Check and adjust tire pressures", "Repair puncture if needed"],
            0.0, "0.5 hours"));
end

// Rule 24: ABS System Fault
rule "ABS System Fault Rule"
    when
        $s: Symptom(warningLights contains "ABS", brakingIssues != null)
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R024", "ABS System Fault Rule",
            "ABS light + braking issues", "Diagnose ABS system"));
        insert(new CarProblem("P024", "ABS System Fault",
            "Anti-lock braking system malfunction", ProblemCategory.BRAKING_SYSTEM, Severity.HIGH,
            ["Faulty wheel sensor", "ABS module failure", "Wiring issue"],
            ["Scan ABS codes", "Test wheel sensors", "Check ABS module"],
            500.0, "3-4 hours"));
end

// Rule 25: Power Steering Issue
rule "Power Steering Rule"
    when
        $s: Symptom(engineNoise == "Groaning", fluidLeaks contains "Red" ||
                   fluidLeaks contains "Clear")
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R025", "Power Steering Rule",
            "Groaning noise + possible fluid leak", "Check power steering system"));
        insert(new CarProblem("P025", "Power Steering Problem",
            "Power assist reduced or noisy", ProblemCategory.SUSPENSION, Severity.MEDIUM,
            ["Low fluid", "Pump failure", "Leaking rack"],
            ["Check fluid level", "Inspect for leaks", "Test pump"],
            350.0, "2-3 hours"));
end

// Rule 26: Serpentine Belt Issue
rule "Serpentine Belt Rule"
    when
        $s: Symptom(engineNoise == "Squealing")
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R026", "Serpentine Belt Rule",
            "Squealing engine noise", "Inspect serpentine/drive belt"));
        insert(new CarProblem("P026", "Worn Serpentine Belt",
            "Drive belt slipping or worn", ProblemCategory.ENGINE, Severity.MEDIUM,
            ["Normal wear", "Misalignment", "Tensioner failure"],
            ["Replace belt", "Check tensioner and pulleys"],
            150.0, "1 hour"));
end

// Rule 27: Timing Belt/Chain
rule "Timing Component Rule"
    when
        $s: Symptom(engineNoise == "Rattling" || engineNoise == "Ticking",
                   mileage > 80000)
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R027", "Timing Component Rule",
            "Rattling/ticking noise + high mileage", "Check timing components"));
        insert(new CarProblem("P027", "Timing Belt/Chain Issue",
            "Timing component wear or misalignment", ProblemCategory.ENGINE, Severity.CRITICAL,
            ["Normal wear", "Tensioner failure", "Guide wear"],
            ["Inspect timing system", "Replace timing components if needed"],
            1000.0, "6-8 hours"));
end

// Rule 28: Vacuum Leak
rule "Vacuum Leak Rule"
    when
        $s: Symptom(roughIdling == true, engineNoise == "Hissing")
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R028", "Vacuum Leak Rule",
            "Hissing noise + rough idle", "Check for vacuum leaks"));
        insert(new CarProblem("P028", "Vacuum Leak",
            "Unmetered air entering engine", ProblemCategory.ENGINE, Severity.MEDIUM,
            ["Cracked hose", "Failed gasket", "Intake manifold leak"],
            ["Smoke test intake", "Replace leaking components"],
            200.0, "2-3 hours"));
end

// Rule 29: EGR Valve Issue
rule "EGR Valve Rule"
    when
        $s: Symptom(roughIdling == true, stalling == true,
                   engineType in (EngineType.DIESEL, EngineType.GASOLINE))
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R029", "EGR Valve Rule",
            "Rough idle + stalling", "Check EGR valve operation"));
        insert(new CarProblem("P029", "EGR Valve Problem",
            "Exhaust gas recirculation malfunction", ProblemCategory.EXHAUST_SYSTEM, Severity.MEDIUM,
            ["Carbon buildup", "Valve failure", "Circuit issues"],
            ["Clean or replace EGR valve", "Check related components"],
            300.0, "2-3 hours"));
end

// Rule 30: PCV Valve Failure
rule "PCV Valve Rule"
    when
        $s: Symptom(unusualSmells contains "Oil", smokeFromExhaust == "Blue")
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R030", "PCV Valve Rule",
            "Oil smell + blue smoke", "Check PCV system"));
        insert(new CarProblem("P030", "PCV Valve Failure",
            "Positive crankcase ventilation issue", ProblemCategory.ENGINE, Severity.MEDIUM,
            ["Clogged valve", "Hose failure"],
            ["Replace PCV valve", "Check hoses"],
            100.0, "1 hour"));
end

// Rule 31: Thermostat Failure
rule "Thermostat Rule"
    when
        $s: Symptom(overheating == true, engineNoise != "Hissing")
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R031", "Thermostat Rule",
            "Overheating without hissing", "Check thermostat operation"));
        insert(new CarProblem("P031", "Faulty Thermostat",
            "Coolant flow regulation failure", ProblemCategory.COOLING_SYSTEM, Severity.MEDIUM,
            ["Stuck closed", "Stuck open", "Spring failure"],
            ["Replace thermostat"],
            150.0, "1-2 hours"));
end

// Rule 32: Water Pump Failure
rule "Water Pump Rule"
    when
        $s: Symptom(overheating == true, fluidLeaks contains "Green" ||
                   fluidLeaks contains "Orange", engineNoise == "Grinding")
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R032", "Water Pump Rule",
            "Overheating + coolant leak + grinding noise", "Check water pump"));
        insert(new CarProblem("P032", "Water Pump Failure",
            "Coolant circulation pump failure", ProblemCategory.COOLING_SYSTEM, Severity.HIGH,
            ["Bearing failure", "Seal leakage", "Impeller damage"],
            ["Replace water pump", "Replace timing belt if driven by it"],
            400.0, "3-5 hours"));
end

// Rule 33: Radiator Fan Issue
rule "Radiator Fan Rule"
    when
        $s: Symptom(overheating == true, electricalProblems contains "Fan Not Working")
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R033", "Radiator Fan Rule",
            "Overheating + fan not working", "Check cooling fan system"));
        insert(new CarProblem("P033", "Radiator Fan Failure",
            "Cooling fan not operating", ProblemCategory.COOLING_SYSTEM, Severity.MEDIUM,
            ["Fan motor failure", "Relay issue", "Temperature sensor", "Wiring problem"],
            ["Test fan circuit", "Replace fan motor if needed"],
            250.0, "2-3 hours"));
end

// Rule 34: Head Gasket Failure
rule "Head Gasket Rule"
    when
        $s: Symptom(overheating == true, smokeFromExhaust == "White",
                   unusualSmells contains "Sweet")
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R034", "Head Gasket Rule",
            "Overheating + white smoke + sweet smell", "Check for head gasket failure"));
        insert(new CarProblem("P034", "Blown Head Gasket",
            "Coolant leaking into combustion chamber", ProblemCategory.ENGINE, Severity.CRITICAL,
            ["Overheating damage", "Manufacturing defect", "Improper installation"],
            ["Pressure test cooling system", "Replace head gasket", "Check head for warping"],
            1500.0, "8-12 hours"));
end

// Rule 35: MAF Sensor Issue
rule "MAF Sensor Rule"
    when
        $s: Symptom(roughIdling == true, stalling == true,
                   fuelConsumptionIncreased == true)
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R035", "MAF Sensor Rule",
            "Rough idle + stalling + increased fuel consumption", "Test MAF sensor"));
        insert(new CarProblem("P035", "Faulty MAF Sensor",
            "Incorrect air flow measurement", ProblemCategory.ENGINE, Severity.MEDIUM,
            ["Contamination", "Sensor failure", "Wiring issue"],
            ["Clean or replace MAF sensor", "Check intake for leaks"],
            200.0, "1 hour"));
end

// Rule 36: IAC Valve Problem
rule "IAC Valve Rule"
    when
        $s: Symptom(roughIdling == true, stalling == true,
                   engineNoise != "Hissing")
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R036", "IAC Valve Rule",
            "Rough idle + stalling without hissing", "Check idle air control valve"));
        insert(new CarProblem("P036", "IAC Valve Issue",
            "Idle speed control malfunction", ProblemCategory.ENGINE, Severity.MEDIUM,
            ["Carbon buildup", "Valve failure", "Electrical issue"],
            ["Clean or replace IAC valve"],
            180.0, "1-2 hours"));
end

// Rule 37: EVAP System Leak
rule "EVAP System Rule"
    when
        $s: Symptom(warningLights contains "Check Engine",
                   unusualSmells contains "Fuel")
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R037", "EVAP System Rule",
            "Check Engine light + fuel smell", "Check EVAP system for leaks"));
        insert(new CarProblem("P037", "EVAP System Leak",
            "Fuel vapor emission control issue", ProblemCategory.FUEL_SYSTEM, Severity.LOW,
            ["Loose gas cap", "Cracked hose", "Charcoal canister"],
            ["Check gas cap", "Smoke test EVAP system"],
            100.0, "1-2 hours"));
end

// Rule 38: Torque Converter Issue
rule "Torque Converter Rule"
    when
        $s: Symptom(transmissionIssues == "Shuddering", lossOfPower == true)
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R038", "Torque Converter Rule",
            "Transmission shudder + power loss", "Check torque converter"));
        insert(new CarProblem("P038", "Torque Converter Problem",
            "Torque converter malfunction", ProblemCategory.TRANSMISSION, Severity.HIGH,
            ["Lockup clutch failure", "Contaminated fluid", "Converter damage"],
            ["Flush transmission", "Replace torque converter if needed"],
            900.0, "5-7 hours"));
end

// Rule 39: CV Joint Failure
rule "CV Joint Rule"
    when
        $s: Symptom(engineNoise == "Clicking" during turns)
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R039", "CV Joint Rule",
            "Clicking noise during turns", "Inspect CV joints"));
        insert(new CarProblem("P039", "CV Joint Failure",
            "Constant velocity joint worn", ProblemCategory.SUSPENSION, Severity.MEDIUM,
            ["Torn boot", "Lack of lubrication", "Normal wear"],
            ["Replace CV axle assembly"],
            350.0, "2-3 hours"));
end

// Rule 40: Wheel Bearing Wear
rule "Wheel Bearing Rule"
    when
        $s: Symptom(engineNoise == "Humming" || engineNoise == "Growling",
                   noiseChanges with speed)
        $d: Diagnosis()
    then
        $d.getRuleChain().add(new RuleExecution("R040", "Wheel Bearing Rule",
            "Humming/growling noise varying with speed", "Check wheel bearings"));
        insert(new CarProblem("P040", "Wheel Bearing Failure",
            "Wheel bearing wear or damage", ProblemCategory.SUSPENSION, Severity.MEDIUM,
            ["Normal wear", "Contamination", "Improper installation"],
            ["Replace wheel bearing/hub assembly"],
            300.0, "2-3 hours"));
end